<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Alamo’s Club - Control Interno</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* === ESTILOS GENERALES === */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background-color: #000;
      color: white;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      text-align: center;
    }

    /* === ANIMACIÓN DE INICIO === */
    #intro {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      animation: fadeOut 2.8s ease forwards;
      animation-delay: 2.2s;
      z-index: 10;
    }

    #intro img {
      width: 160px;
      max-width: 40%;
      opacity: 0;
      animation: zoomLogo 2s ease forwards;
    }

    #intro h1 {
      font-size: 2.4em;
      margin-top: 15px;
      opacity: 0;
      animation: showText 2s ease forwards 1.4s;
      color: #f1c40f;
      word-wrap: break-word;
    }

    @keyframes zoomLogo {
      0% { transform: scale(0.2); opacity: 0; }
      50% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes showText {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      to { opacity: 0; visibility: hidden; }
    }

    /* === LOGIN === */
    #login {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: radial-gradient(circle at center, #111 0%, #000 100%);
      transition: opacity 0.8s;
      padding: 10px;
    }

    #login img {
      width: 160px;
      max-width: 40%;
      margin-bottom: 20px;
      border-radius: 50%;
    }

    input[type="password"] {
      padding: 16px;
      border-radius: 8px;
      border: none;
      width: 70%;
      max-width: 400px;
      font-size: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    button {
      background: #e91e63;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 10px;
      padding: 16px 32px;
      cursor: pointer;
      font-size: 20px;
      transition: 0.3s;
      word-wrap: break-word;
    }

    button:hover { background: #ff4081; }

    /* === PANEL PRINCIPAL === */
    #panel {
      display: none;
      height: 100vh;
      background-color: #111;
      flex-direction: column;
      overflow-x: hidden;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .header img {
      width: 100px;
      max-width: 30%;
      height: 100px;
      object-fit: cover;
      border-radius: 50%;
    }

    .content {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 20px;
      padding: 10px;
    }

    .menu-btn {
      width: 80%;
      max-width: 300px;
      padding: 20px;
      font-size: 24px;
      border-radius: 16px;
      background: linear-gradient(135deg, #e91e63, #f1c40f);
      color: black;
      font-weight: bold;
      transition: 0.3s;
    }

    .menu-btn:hover { transform: scale(1.05); }

    .small-btn {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 8px;
      background: #444;
    }

    /* === PANEL DE VENTAS (EMPLEADO) Y VISUALIZACION DE VENTAS (SOCIO) === */
    #ventasPanel, #visualizacionVentasPanel {
      display: none;
      padding: 20px;
      text-align: center;
      max-width: 900px; /* Ancho para la tabla de visualización */
      margin: 0 auto;
    }
    
    /* Estilos para la tabla de visualización de ventas de Socios */
    table.ventasVisualTable {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 12px;
        color: white;
    }

    table.ventasVisualTable th, table.ventasVisualTable td {
        border-bottom: 1px solid #333;
        padding: 10px;
        text-align: left;
    }

    table.ventasVisualTable th {
        font-size: 16px;
        color: #f1c40f;
    }

    /* === PANEL DE VENTAS COMO TABLA (EMPLEADO) === */
    table.ventasTable {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 20px;
      border-collapse: separate;
      border-spacing: 15px 10px;
    }

    table.ventasTable td {
      vertical-align: middle;
      font-size: 22px;
      text-align: center;
    }

    table.ventasTable td button {
      width: 50px;
      height: 50px;
      font-size: 24px;
      border-radius: 10px;
      margin: 0 5px;
    }

    #total {
      font-size: 28px;
      margin-bottom: 20px;
      word-wrap: break-word;
    }

    #ventasPanel button.volver-btn, #visualizacionVentasPanel button.volver-btn {
      margin-top: 10px;
      padding: 14px 30px;
      font-size: 20px;
      border-radius: 12px;
    }

    /* === LISTA DE INVITADOS === */
    #invitadosPanel {
      display: none;
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
      text-align: center;
    }

    .nombre {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      background: #222;
      padding: 15px;
      border-radius: 12px;
      margin: 8px 0;
      font-size: 20px;
      align-items: center;
      gap: 10px;
    }

    .nombre button {
      background: #27ae60;
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 10px;
      word-wrap: break-word;
    }

    .nombre button:disabled { background: gray; }

    input#buscar {
      font-size: 18px;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: none;
      width: 80%;
      max-width: 400px;
    }

    /* === BARRA DE PROGRESO === */
    .progress-container {
      display: flex;
      align-items: center;
      margin: 20px auto;
      justify-content: center;
      width: 90%;
      max-width: 600px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .progress-icon {
      width: 50px;
      max-width: 15%;
      height: 50px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .progress-bar {
      flex: 1;
      height: 20px;
      background: #333;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #f1c40f, #e91e63);
      transition: width 0.5s ease;
    }

    /* === SOCIOS: MENU Y SUBPANELS === */
    #menuSocios {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 20px;
    }

    .socios-small {
      width: 160px;
      padding: 12px;
      font-size: 18px;
      border-radius: 12px;
    }

    /* === REGISTRO PRODUCTO === */
    #registroPanel {
      display: none;
      padding: 20px;
      max-width: 720px;
      margin: 0 auto;
      text-align: center;
    }

    .registro-row {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
      align-items: center;
    }
    
    /* Estilo para el SELECT del evento */
    select#eventoTarget {
        padding: 12px;
        font-size: 18px;
        border-radius: 8px;
        border: none;
        width: 80%;
        max-width: 400px;
        margin-bottom: 15px;
        text-align: center;
    }

    input[type="text"].prod-name {
      padding: 12px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      width: 40%;
      min-width: 160px;
    }

    input[type="number"].prod-price {
      padding: 12px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      width: 20%;
      min-width: 120px;
      text-align: center;
    }

    .qty-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-controls button {
      width: 44px;
      height: 44px;
      font-size: 22px;
      border-radius: 8px;
    }

    .checkbox-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 12px;
      align-items: center;
    }

    /* === LISTA REGISTRO === */
    #listaRegistroPanel {
      display: none;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    table.registrosTable {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 12px;
    }

    table.registrosTable th, table.registrosTable td {
      border-bottom: 1px solid #333;
      padding: 10px;
      text-align: left;
    }

    table.registrosTable th {
      font-size: 16px;
      color: #f1c40f;
    }

    .total-row {
      text-align: right;
      font-size: 18px;
      margin-top: 10px;
    }
    
    /* Estilo para la paginación de tablas */
    .pagination-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 20px;
        gap: 8px;
    }
    .pagination-btn {
        padding: 10px 15px;
        font-size: 16px;
        border-radius: 8px;
        background: #333;
        color: white;
        cursor: pointer;
        border: 1px solid transparent;
    }
    .pagination-btn.active {
        background: #f1c40f;
        color: black;
        font-weight: bold;
    }

    /* === PANEL GANANCIA (NUEVO) === */
    #gananciaPanel {
      display: none;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }
    #gananciaPanel .input-row {
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    #gananciaPanel input[type="number"] {
      padding:12px;
      font-size:18px;
      border-radius:8px;
      border:none;
      width: 60%;
      max-width:400px;
      text-align:center;
    }
    #gananciaPanel .btn-row { display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap; }

    table.gananciasEventosTable, table.gananciasSociosTable {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 12px;
      color: white;
    }
    table.gananciasEventosTable th, table.gananciasEventosTable td,
    table.gananciasSociosTable th, table.gananciasSociosTable td {
      border-bottom:1px solid #333;
      padding:10px;
      text-align:left;
    }
    table.gananciasEventosTable th, table.gananciasSociosTable th { color:#f1c40f; font-size:16px; }

    /* === INVERSION === */
    #inversionPanel {
      display: none;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }

    table.inversionTable {
      width: 100%;
      border-collapse: collapse;
    }

    table.inversionTable th, table.inversionTable td {
      padding: 10px;
      border-bottom: 1px solid #333;
      text-align: left;
    }

    table.inversionTable th {
      color: #f1c40f;
    }

    /* === MEDIA QUERIES PARA RESPONSIVE === */
    @media (max-width: 768px) {
      .menu-btn { font-size: 20px; padding: 16px; }
      table.ventasTable td { font-size: 20px; }
      table.ventasTable td button { width: 45px; height: 45px; font-size: 20px; }
      #total { font-size: 24px; }
      .nombre { font-size: 18px; padding: 12px; }
      .nombre button { font-size: 16px; padding: 8px 16px; }
      input#buscar { font-size: 16px; }
      .progress-bar { height: 15px; }
      .progress-icon { width: 40px; height: 40px; }
      input[type="text"].prod-name { width: 100%; }
    }

    @media (max-width: 480px) {
      .menu-btn { font-size: 18px; padding: 12px; }
      table.ventasTable td { font-size: 18px; }
      table.ventasTable td button { width: 40px; height: 40px; font-size: 18px; }
      #total { font-size: 20px; }
      .nombre { font-size: 16px; padding: 10px; flex-direction: column; gap: 5px; }
      .nombre button { font-size: 14px; padding: 6px 12px; }
      input#buscar { font-size: 14px; }
      .progress-bar { height: 12px; }
      .progress-icon { width: 30px; height: 30px; }
      .registro-row { flex-direction: column; }
      input[type="text"].prod-name { width: 100%; }
      input[type="number"].prod-price { width: 48%; }
    }
  </style>
</head>
<body>

  <div id="intro">
    <img src="LOGO.PNG" alt="Logo">
    <h1>Bienvenido</h1>
  </div>

  <div id="login">
    <img src="logotipo.png" alt="Logotipo">
    <input type="password" id="password" placeholder="Contraseña">
    <button onclick="login()">Ingresar</button>
  </div>

  <div id="panel">
    <div class="header">
      <img src="LOGO.PNG" alt="Logo">
      <img src="logotipo.png" alt="Logotipo">
    </div>

    <div class="content" id="menuPrincipal">
      <button class="menu-btn" onclick="mostrarVentas()">Barra de Bebidas</button>
      <button class="menu-btn" onclick="mostrarInvitados()">Lista de Invitados</button>
      <button class="small-btn" style="margin-top:12px;" onclick="salirAInicio()">Exit</button>
    </div>

    <div class="content" id="menuSocios">
      <button class="menu-btn" onclick="abrirRegistro()">Registro</button>
      <button class="menu-btn" onclick="abrirListaRegistro()">Lista Registro</button>
      <button class="menu-btn" onclick="abrirInversion()">Inversión</button>
      <button class="menu-btn" onclick="abrirVisualizacionVentas()">Ventas</button>
      <!-- NUEVO BOTON GANANCIA -->
      <button class="menu-btn" onclick="abrirGanancia()">Ganancia</button>
      <button class="small-btn" style="margin-top:12px;" onclick="salirAInicio()">Exit</button>
    </div>

    <div id="ventasPanel">
      <h2 style="font-size: 36px;">Registro de Ventas</h2>
      <table class="ventasTable">
        <tr>
          <td>Promoción ($250)</td>
          <td>
            <button onclick="modificar('promo', -1)">−</button>
            <span id="promoCount">0</span>
            <button onclick="modificar('promo', 1)">+</button>
          </td>
        </tr>
        <tr>
          <td>Unidad ($150)</td>
          <td>
            <button onclick="modificar('unidad', -1)">−</button>
            <span id="unidadCount">0</span>
            <button onclick="modificar('unidad', 1)">+</button>
          </td>
        </tr>
        <tr>
          <td>Total:</td>
          <td><span id="total">$0</span></td>
        </tr>
      </table>
      <button onclick="pagar()">Pagar</button>
      <button class="volver-btn" onclick="volverMenu()">Volver</button>
    </div>
    
    <div id="visualizacionVentasPanel">
        <h2 style="font-size: 32px;">Ventas por Barra de Bebidas</h2>
        <div id="ventasContainer">
            </div>
        <div class="total-row" id="totalVentasGeneral">Total General: $0</div>
        <div style="margin-top:12px;">
            <button class="menu-btn socios-small" onclick="cerrarVisualizacionVentas()">Volver</button>
        </div>
    </div>

    <div id="invitadosPanel">
      <h2 style="font-size: 36px;">Lista de Invitados</h2>

      <div class="progress-container">
        <img src="LOGO.PNG" alt="Logo" class="progress-icon">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <img src="FLAG.PNG" alt="Meta" class="progress-icon">
      </div>

      <input type="text" id="buscar" placeholder="Buscar nombre...">
      <div id="output"></div>
      <button onclick="volverMenu()">Volver</button>
    </div>

    <div id="registroPanel">
      <h2 style="font-size: 32px;">Registro de Producto</h2>
      
      <select id="eventoTarget">
          <option value="registros">Registro Evento</option>
          <option value="nuevo_evento">➕ Crear Nuevo Evento</option>
      </select>
      <input type="text" id="nombreNuevoEvento" placeholder="Ej: Evento VIP" style="display:none; margin-bottom: 15px; padding: 12px; font-size: 18px; border-radius: 8px; border: none; width: 80%; max-width: 400px; text-align: center;">

      <div class="registro-row">
        <input type="text" id="prodNombre" class="prod-name" placeholder="Nombre del producto">
        <input type="number" id="prodPrecio" class="prod-price" placeholder="Precio" min="0" step="0.01">
        <div class="qty-controls">
          <button onclick="cambiarUnidades(-1)">−</button>
          <div id="unidadesDisplay" style="font-size:20px;padding:0 10px;min-width:34px;">1</div>
          <button onclick="cambiarUnidades(1)">+</button>
        </div>
      </div>

      <div class="checkbox-row">
        <label><input type="checkbox" id="chkIguales"> Partes iguales</label>
        <label><input type="checkbox" id="chkPorcentaje"> Porcentaje</label>
      </div>

      <div style="display:flex;gap:12px;justify-content:center;margin-top:12px;">
        <button class="menu-btn socios-small" onclick="registrarProducto()">Registrar</button>
        <button class="menu-btn socios-small" onclick="cerrarRegistro()">Volver</button>
      </div>
    </div>

    <div id="listaRegistroPanel">
      <h2 style="font-size: 32px;">Lista de Registros</h2>
      
      <div id="paginationContainer" class="pagination-container">
          </div>
      
      <div id="listaRegistrosContainer">
        </div>
      <div class="total-row" id="totalRegistros">Total General: $0</div>
      <div style="margin-top:12px;">
        <button class="menu-btn socios-small" onclick="cerrarListaRegistro()">Volver</button>
      </div>
    </div>

    <div id="inversionPanel">
      <h2 style="font-size: 32px;">Inversión por Socio</h2>
      <div id="inversionContainer">
        </div>
      <div style="margin-top:12px;">
        <button class="menu-btn socios-small" onclick="cerrarInversion()">Volver</button>
      </div>
    </div>

    <!-- NUEVO PANEL GANANCIA -->
    <div id="gananciaPanel">
      <h2 style="font-size:32px;">Ganancias por Evento</h2>

      <div class="input-row">
        <input type="number" id="cantidadObtenida" placeholder="Cantidad obtenida (solo números)" min="0" step="0.01">
      </div>

      <div class="btn-row">
        <button class="menu-btn socios-small" onclick="guardarGanancia()">Ganancia total</button>
        <button class="menu-btn socios-small" onclick="cerrarGanancia()">Volver</button>
      </div>

      <hr style="width:90%; margin:18px auto; border-color:#333;">

      <h3 style="font-size:20px; margin-top:10px;">Eventos (Evento | Ganancia)</h3>
      <div id="gananciasEventosContainer">Cargando...</div>

      <h3 style="font-size:20px; margin-top:10px;">Ganancias por Socio</h3>
      <div id="gananciasSociosContainer">Cargando...</div>
    </div>

  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDLW12w5ZznypXJYMrTNouttdX0vrG6Bzg",
      authDomain: "alamos-club-d1847.firebaseapp.com",
      projectId: "alamos-club-d1847",
      storageBucket: "alamos-club-d1847.firebasestorage.app",
      messagingSenderId: "666754924136",
      appId: "1:666754924136:web:03b63136a94e98515d45dd",
      measurementId: "G-MNFMT9QLBN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Lista global de colecciones de registro
    let registroCollections = [{ id: 'registros', nombre: 'Bar Principal' }];
    let currentRegistroCollection = 'registros'; // Colección activa por defecto

    // CONTROL DE INTRO (ocultar después)
    window.addEventListener('load', () => {
      setTimeout(() => {
        const intro = document.getElementById('intro');
        if (intro) intro.style.display = 'none';
      }, 3200);
    });

    // LOGIN
    function login() {
      const pass = document.getElementById("password").value;
      if (pass === "12345") {
        // empleado
        document.getElementById("login").style.display = "none";
        document.getElementById("panel").style.display = "flex";
        document.getElementById("menuPrincipal").style.display = "flex";
        document.getElementById("menuSocios").style.display = "none";
      } else if (pass === "Aldoariel2") {
        // SOCIO
        document.getElementById("login").style.display = "none";
        document.getElementById("panel").style.display = "flex";
        document.getElementById("menuPrincipal").style.display = "none";
        document.getElementById("menuSocios").style.display = "flex";
      } else {
        alert("❌ Contraseña incorrecta");
      }
    }

    function salirAInicio() {
      // regresa a pantalla de login (empleado exit)
      document.getElementById("panel").style.display = "none";
      document.getElementById("login").style.display = "flex";
      document.getElementById("password").value = "";
      // ocultar subpanels por si acaso
      hideAllPanels();
    }

    function hideAllPanels() {
      // ocultar todos los subpanels
      document.getElementById("ventasPanel").style.display = "none";
      document.getElementById("invitadosPanel").style.display = "none";
      document.getElementById("registroPanel").style.display = "none";
      document.getElementById("listaRegistroPanel").style.display = "none";
      document.getElementById("inversionPanel").style.display = "none";
      document.getElementById("visualizacionVentasPanel").style.display = "none";
      document.getElementById("gananciaPanel").style.display = "none";
      // mostrar menus por defecto ocultos
      document.getElementById("menuPrincipal").style.display = "none";
      document.getElementById("menuSocios").style.display = "none";
    }
    
    // ---------------------------------------------------------------------
    // MANEJO DE EVENTOS (NUEVO)
    async function loadEventCollections() {
        try {
            // Cargar los eventos registrados en la colección de control 'eventos'
            const snapshot = await db.collection("eventos").orderBy("fechaCreacion", "asc").get();
            const eventos = snapshot.docs.map(doc => ({ id: doc.id, nombre: doc.data().nombre || doc.id }));
            
            // La colección 'registros' es la base (Bar Principal)
            registroCollections = [{ id: 'registros', nombre: 'Bar Principal' }];
            
            // Agregar las colecciones de eventos
            eventos.forEach((ev) => {
                registroCollections.push({
                    id: ev.id, 
                    nombre: ev.nombre 
                });
            });
            // Si la colección actual no existe (ej. fue borrada), volvemos a la principal
            if (!registroCollections.find(c => c.id === currentRegistroCollection)) {
                currentRegistroCollection = 'registros';
            }
        } catch (e) {
            console.error("Error al cargar colecciones de eventos:", e);
        }
    }
    
    function renderPagination() {
        const container = document.getElementById("paginationContainer");
        container.innerHTML = "";
        
        registroCollections.forEach(col => {
            const button = document.createElement("button");
            button.className = `pagination-btn ${col.id === currentRegistroCollection ? 'active' : ''}`;
            button.textContent = col.nombre;
            button.onclick = () => {
                currentRegistroCollection = col.id;
                // Vuelve a renderizar la lista con la colección seleccionada
                renderListaRegistro(currentRegistroCollection); 
                renderPagination(); // Actualiza el estado 'active' del botón
            };
            container.appendChild(button);
        });
    }

    // ---------------------------------------------------------------------
    // PANEL DE VENTAS (empleado) - sin cambios lógicos
    let promo = 0, unidad = 0;
    function mostrarVentas() {
      document.getElementById("menuPrincipal").style.display = "none";
      document.getElementById("ventasPanel").style.display = "block";
    }
    function modificar(tipo, valor) {
      if (tipo === "promo") promo = Math.max(0, promo + valor);
      if (tipo === "unidad") unidad = Math.max(0, unidad + valor);
      actualizarTotal();
    }
    function actualizarTotal() {
      const total = promo * 250 + unidad * 150;
      document.getElementById("promoCount").textContent = promo;
      document.getElementById("unidadCount").textContent = unidad;
      document.getElementById("total").textContent = "$" + total;
    }
    async function pagar() {
      const total = promo * 250 + unidad * 150;
      if (total === 0) {
        alert("⚠️ No hay productos en la venta");
        return;
      }
      try {
        await db.collection("ventas").add({
          fecha: new Date(),
          promociones: promo,
          unidades: unidad,
          total: total
        });
        alert("✅ Venta registrada correctamente.");
        promo = 0; unidad = 0;
        actualizarTotal();
      } catch (e) {
        alert("❌ Error al registrar venta: " + e.message);
      }
    }
    function volverMenu() {
      // Usado para volver de 'Barra de Bebidas' o 'Lista de Invitados' (Empleado)
      document.getElementById("ventasPanel").style.display = "none";
      document.getElementById("invitadosPanel").style.display = "none";
      document.getElementById("menuPrincipal").style.display = "flex";
    }

    // LISTA DE INVITADOS (empleado) - sin cambios lógicos
    async function mostrarInvitados() {
      document.getElementById("menuPrincipal").style.display = "none";
      document.getElementById("invitadosPanel").style.display = "block";
      const output = document.getElementById("output");
      const buscar = document.getElementById("buscar");

      let snapshot = await db.collection("invitados").orderBy("nombre").get();
      let invitados = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

      function render(filtro = "") {
        output.innerHTML = "";
        const filtrados = invitados.filter(i => i.nombre.toLowerCase().includes(filtro.toLowerCase()));
        filtrados.forEach(inv => {
          const div = document.createElement("div");
          div.className = "nombre";

          const span = document.createElement("span");
          span.textContent = inv.nombre;

          const btn = document.createElement("button");
          btn.textContent = inv.asistio ? "✅ Asistió" : "Marcar asistencia";
          btn.disabled = inv.asistio;

          btn.onclick = async () => {
            await db.collection("invitados").doc(inv.id).update({ asistio: true });
            inv.asistio = true;
            btn.textContent = "✅ Asistió";
            btn.disabled = true;
            actualizarProgreso();
          };

          div.appendChild(span);
          div.appendChild(btn);
          output.appendChild(div);
        });
        actualizarProgreso();
      }

      function actualizarProgreso() {
        const total = invitados.length || 1;
        const asistieron = invitados.filter(i => i.asistio).length;
        const porcentaje = (asistieron / total) * 100;
        document.getElementById("progressFill").style.width = porcentaje + "%";
      }

      render();
      buscar.addEventListener("input", e => render(e.target.value));
    }

    // ---------------------------------------------------------------------
    // SOCIOS - navegación
    async function abrirRegistro() {
      document.getElementById("menuSocios").style.display = "none";
      document.getElementById("registroPanel").style.display = "block";
      
      await loadEventCollections(); // Carga las colecciones de eventos existentes
      renderEventSelector(); // Renderiza el selector de eventos

      // inicializar campos
      document.getElementById("prodNombre").value = "";
      document.getElementById("prodPrecio").value = "";
      unidades = 1;
      document.getElementById("unidadesDisplay").textContent = unidades;
      document.getElementById("chkIguales").checked = true;
      document.getElementById("chkPorcentaje").checked = false;
    }
    
    // NUEVA FUNCIÓN para renderizar el selector de eventos
    function renderEventSelector() {
        const selector = document.getElementById("eventoTarget");
        const inputNuevoEvento = document.getElementById("nombreNuevoEvento");
        
        // Limpiar opciones existentes
        selector.innerHTML = "";
        
        // Agregar la opción principal
        selector.innerHTML += `<option value="registros">Registro Principal (Bar)</option>`;

        // Agregar los eventos cargados
        registroCollections.filter(c => c.id !== 'registros').forEach(col => {
            selector.innerHTML += `<option value="${col.id}">${col.nombre}</option>`;
        });

        // Agregar la opción de crear nuevo
        selector.innerHTML += `<option value="nuevo_evento">➕ Crear Nuevo Evento</option>`;

        // Manejar visibilidad del input de nuevo evento
        selector.onchange = () => {
            if (selector.value === "nuevo_evento") {
                inputNuevoEvento.style.display = "block";
            } else {
                inputNuevoEvento.style.display = "none";
            }
        };
        
        // Inicializar el estado de la lista
        inputNuevoEvento.style.display = "none";
        selector.value = "registros";
    }


    function cerrarRegistro() {
      document.getElementById("registroPanel").style.display = "none";
      document.getElementById("menuSocios").style.display = "flex";
    }

    async function abrirListaRegistro() {
      document.getElementById("menuSocios").style.display = "none";
      document.getElementById("listaRegistroPanel").style.display = "block";
      await loadEventCollections(); // Carga la lista de colecciones disponibles
      renderPagination(); // Renderiza los botones de navegación
      // Renderiza la lista con la colección activa por defecto (Bar Principal)
      renderListaRegistro(currentRegistroCollection); 
    }

    function cerrarListaRegistro() {
      document.getElementById("listaRegistroPanel").style.display = "none";
      document.getElementById("menuSocios").style.display = "flex";
    }

    async function abrirInversion() {
      document.getElementById("menuSocios").style.display = "none";
      document.getElementById("inversionPanel").style.display = "block";
      await loadEventCollections(); // Asegurar que tenemos la lista de colecciones
      renderInversion(); // Renderizar la inversión
    }

    function cerrarInversion() {
      document.getElementById("inversionPanel").style.display = "none";
      document.getElementById("menuSocios").style.display = "flex";
    }
    
    function abrirVisualizacionVentas() {
        document.getElementById("menuSocios").style.display = "none";
        document.getElementById("visualizacionVentasPanel").style.display = "block";
        renderVisualizacionVentas();
    }

    function cerrarVisualizacionVentas() {
        document.getElementById("visualizacionVentasPanel").style.display = "none";
        document.getElementById("menuSocios").style.display = "flex";
    }

    // ============================================================
    // NUEVO: GANANCIA - abrir/cerrar / renderizado / guardar
    async function abrirGanancia() {
      document.getElementById("menuSocios").style.display = "none";
      document.getElementById("gananciaPanel").style.display = "block";

      // asegurarse de tener las colecciones de registros (registros + eventos)
      await loadEventCollections();

      // cargar y renderizar tablas de ganancias
      await renderGananciasEventos();
      await renderGananciasSocios();
    }

    function cerrarGanancia() {
      document.getElementById("gananciaPanel").style.display = "none";
      document.getElementById("menuSocios").style.display = "flex";
      // limpiar input
      document.getElementById("cantidadObtenida").value = "";
    }

    // Render tabla de eventos (colección: ganancias_eventos)
    async function renderGananciasEventos() {
      const container = document.getElementById("gananciasEventosContainer");
      container.innerHTML = "Cargando eventos...";
      try {
        const snapshot = await db.collection("ganancias_eventos").orderBy("eventoNumber", "asc").get();
        const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
        if (docs.length === 0) {
          container.innerHTML = "<div>No hay registros de ganancias aún.</div>";
          return;
        }
        let html = '<table class="gananciasEventosTable"><thead><tr><th>Evento</th><th>Ganancia</th></tr></thead><tbody>';
        docs.forEach(d => {
          const eventoLabel = d.eventoLabel || (`Evento ${d.eventoNumber}`);
          html += `<tr><td>${escapeHtml(eventoLabel)}</td><td>$${formatNumber(parseFloat(d.ganancia || 0))}</td></tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = "<div>Error al cargar ganancias por evento: " + e.message + "</div>";
      }
    }

    // Render tabla de socios (colección: ganancias_socios)
    async function renderGananciasSocios() {
      const container = document.getElementById("gananciasSociosContainer");
      container.innerHTML = "Cargando socios...";
      try {
        const snapshot = await db.collection("ganancias_socios").get();
        const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
        // si no existen, crear los tres socios con 0 (solo la primera vez)
        if (docs.length === 0) {
          // crear documentos Aldo, Ariel, Axel
          const batch = db.batch();
          const aldoRef = db.collection("ganancias_socios").doc("Aldo");
          const arielRef = db.collection("ganancias_socios").doc("Ariel");
          const axelRef = db.collection("ganancias_socios").doc("Axel");
          batch.set(aldoRef, { nombre: "Aldo", acumulado: 0 });
          batch.set(arielRef, { nombre: "Ariel", acumulado: 0 });
          batch.set(axelRef, { nombre: "Axel", acumulado: 0 });
          await batch.commit();
          // volver a llamar para renderizar
          return renderGananciasSocios();
        }
        // armar tabla
        let html = '<table class="gananciasSociosTable"><thead><tr><th>Nombre del socio</th><th>Ganancia acumulada</th></tr></thead><tbody>';
        docs.forEach(d => {
          html += `<tr><td>${escapeHtml(d.nombre || d.id)}</td><td>$${formatNumber(parseFloat(d.acumulado || 0))}</td></tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = "<div>Error al cargar ganancias de socios: " + e.message + "</div>";
      }
    }

    // Guardar nueva ganancia: calcula ganancia del evento y reparte entre socios
    async function guardarGanancia() {
      const input = document.getElementById("cantidadObtenida");
      const cantidadStr = input.value;
      const cantidad = parseFloat(cantidadStr);
      if (isNaN(cantidad) || cantidad < 0) {
        alert("Ingresa una cantidad válida (número).");
        return;
      }

      // Determinar número de evento (siguiente consecutivo)
      // Usamos el número de documentos en ganancias_eventos + 1
      try {
        const snapshotEventos = await db.collection("ganancias_eventos").get();
        const nextEventoNumber = snapshotEventos.size + 1; // evento 1, 2, 3...

        // Determinar la colección de registros correspondiente al evento:
        // Por convención: evento 1 -> registroCollections[0] ('registros' => Bar Principal)
        // evento N -> registroCollections[N-1] si existe, sino 'registros'
        let collectionForEventId = 'registros';
        let collectionForEventLabel = 'Evento 1';
        if (registroCollections.length >= nextEventoNumber) {
          collectionForEventId = registroCollections[nextEventoNumber - 1].id;
          collectionForEventLabel = registroCollections[nextEventoNumber - 1].nombre;
        } else {
          // Si no existe un registro creado para ese número, usar 'registros' como fallback
          collectionForEventId = 'registros';
          collectionForEventLabel = registroCollections[0]?.nombre || 'Evento 1';
        }

        // Obtener total general del evento (colección: collectionForEventId)
        // Se calcula como suma de unidadPrecio * unidades (mismo cálculo que en renderListaRegistro)
        let totalInvertido = 0;
        try {
          const snapshotReg = await db.collection(collectionForEventId).get();
          snapshotReg.docs.forEach(d => {
            const r = d.data();
            const unidadesR = parseFloat(r.unidades) || 0;
            const precioUnidad = parseFloat(r.unidadPrecio) || 0;
            totalInvertido += unidadesR * precioUnidad;
          });
        } catch (err) {
          console.error("Error al leer registros del evento para calcular inversión:", err);
          totalInvertido = 0;
        }

        // calcular ganancia del evento según tu fórmula
        const gananciaEvento = cantidad - totalInvertido;

        // confirmación al usuario
        const confirmMsg = `Vas a registrar la ganancia del Evento ${nextEventoNumber} (${collectionForEventLabel}).\n\n` +
                           `Cantidad obtenida: $${formatNumber(cantidad)}\n` +
                           `Total invertido en el evento: $${formatNumber(totalInvertido)}\n` +
                           `Ganancia resultante: $${formatNumber(gananciaEvento)}\n\n¿Confirmar?`;
        if (!confirm(confirmMsg)) return;

        // 1) Guardar documento en ganancias_eventos
        await db.collection("ganancias_eventos").add({
          eventoNumber: nextEventoNumber,
          eventoLabel: `Evento ${nextEventoNumber} - ${collectionForEventLabel}`,
          cantidadObtenida: cantidad,
          totalInvertido: totalInvertido,
          ganancia: gananciaEvento,
          fecha: new Date()
        });

        // 2) Repartir entre socios y actualizar ganancias_socios acumuladas
        // Aldo 60%, Ariel 20%, Axel 20%
        const aldoShare = gananciaEvento * 0.6;
        const arielShare = gananciaEvento * 0.2;
        const axelShare = gananciaEvento * 0.2;

        // Update each socio doc (create if not exists)
        const sociosRef = db.collection("ganancias_socios");
        // Aldo
        const aldoDoc = await sociosRef.doc("Aldo").get();
        if (aldoDoc.exists) {
          const prev = parseFloat(aldoDoc.data().acumulado || 0);
          await sociosRef.doc("Aldo").update({ acumulado: prev + aldoShare });
        } else {
          await sociosRef.doc("Aldo").set({ nombre: "Aldo", acumulado: aldoShare });
        }
        // Ariel
        const arielDoc = await sociosRef.doc("Ariel").get();
        if (arielDoc.exists) {
          const prev = parseFloat(arielDoc.data().acumulado || 0);
          await sociosRef.doc("Ariel").update({ acumulado: prev + arielShare });
        } else {
          await sociosRef.doc("Ariel").set({ nombre: "Ariel", acumulado: arielShare });
        }
        // Axel
        const axelDoc = await sociosRef.doc("Axel").get();
        if (axelDoc.exists) {
          const prev = parseFloat(axelDoc.data().acumulado || 0);
          await sociosRef.doc("Axel").update({ acumulado: prev + axelShare });
        } else {
          await sociosRef.doc("Axel").set({ nombre: "Axel", acumulado: axelShare });
        }

        // 3) Actualizar en pantalla ambas tablas sin recargar
        await renderGananciasEventos();
        await renderGananciasSocios();

        alert("✅ Ganancia registrada correctamente.");
        // limpiar input
        input.value = "";

      } catch (e) {
        alert("❌ Error al registrar ganancia: " + e.message);
      }
    }

    // ============================================================
    // REGISTRO - lógica (MODIFICADO para soportar Eventos)
    let unidades = 1;
    function cambiarUnidades(delta) {
      unidades = Math.max(1, unidades + delta);
      document.getElementById("unidadesDisplay").textContent = unidades;
    }

    // hacer los checkboxes mutualmente excluyentes
    document.addEventListener('change', (e) => {
      if (e.target && e.target.id === 'chkIguales' && e.target.checked) {
        document.getElementById('chkPorcentaje').checked = false;
      }
      if (e.target && e.target.id === 'chkPorcentaje' && e.target.checked) {
        document.getElementById('chkIguales').checked = false;
      }
    });

    async function registrarProducto() {
        const selector = document.getElementById("eventoTarget");
        let collectionName = selector.value;
        const nombreNuevoEventoInput = document.getElementById("nombreNuevoEvento");
        const nombreEventoUsuario = nombreNuevoEventoInput.value.trim();

        if (collectionName === "nuevo_evento") {
            if (!nombreEventoUsuario) {
                alert("Por favor, ingresa el nombre del nuevo evento.");
                return;
            }
            
            // Lógica para crear un nuevo evento/colección
            
            // 1. Obtener el número consecutivo (Ej. Evento 1, Evento 2)
            const eventosSnapshot = await db.collection("eventos").get();
            const nextEventNumber = eventosSnapshot.size + 1;
            
            // 2. Crear el nombre de la colección real y el nombre a mostrar
            const newCollectionId = `evento_${nextEventNumber}`; // ID único en Firebase (nombre de la colección)
            const newEventName = `Evento ${nextEventNumber} (${nombreEventoUsuario})`; // Nombre de despliegue
            
            // 3. Registrar el evento en la colección de control 'eventos'
            try {
                await db.collection("eventos").doc(newCollectionId).set({
                    nombre: newEventName,
                    fechaCreacion: new Date()
                });
                collectionName = newCollectionId; // La colección de destino es la nueva
                alert(`✅ Nuevo evento "${newEventName}" creado.`);
            } catch (e) {
                alert("❌ Error al crear nuevo evento: " + e.message);
                return;
            }
        }

        const nombre = (document.getElementById("prodNombre").value || "").trim();
        const precioStr = document.getElementById("prodPrecio").value;
        const precio = parseFloat(precioStr);
        const chkIguales = document.getElementById("chkIguales").checked;
        const chkPorcentaje = document.getElementById("chkPorcentaje").checked;

        if (!nombre) {
            alert("Ingresa el nombre del producto.");
            return;
        }
        if (isNaN(precio) || precio < 0) {
            alert("Ingresa un precio válido.");
            return;
        }
        if (!chkIguales && !chkPorcentaje) {
            alert("Selecciona un método de reparto: Partes iguales o Porcentaje.");
            return;
        }

        const targetName = registroCollections.find(c => c.id === collectionName)?.nombre || collectionName;
        // confirmación
        const confirmMsg = `Vas a registrar en la tabla: ${targetName}\n\n${nombre}\nCantidad: ${unidades}\nPrecio por unidad: $${precio.toFixed(2)}\nTotal: $${(precio * unidades).toFixed(2)}\n\nReparto: ${chkIguales ? 'Partes Iguales (1/3)' : 'Porcentaje (60/20/20)'}\n\n¿Confirmar?`;
        if (!confirm(confirmMsg)) return;

        // guardar en Firestore colección dinámica
        try {
            await db.collection(collectionName).add({
                nombre: nombre,
                unidadPrecio: precio,
                unidades: unidades,
                splitType: chkIguales ? "igual" : "porcentaje",
                fecha: new Date()
            });
            alert("✅ Registro exitoso en " + targetName);
            
            // Si creamos un nuevo evento, volvemos a cargar el selector para que aparezca la opción
            if (selector.value === "nuevo_evento") {
                await loadEventCollections();
                renderEventSelector();
            }

            // reset form
            document.getElementById("prodNombre").value = "";
            document.getElementById("prodPrecio").value = "";
            nombreNuevoEventoInput.value = "";
            unidades = 1;
            document.getElementById("unidadesDisplay").textContent = unidades;
            document.getElementById("chkIguales").checked = true;
            document.getElementById("chkPorcentaje").checked = false;
            selector.value = "registros";
            nombreNuevoEventoInput.style.display = "none";
        } catch (e) {
            alert("❌ Error al guardar registro: " + e.message);
        }
    }

    // ============================================================
    // LISTA REGISTRO - renderiza tabla agrupada por nombre (MODIFICADO para colección dinámica)
    async function renderListaRegistro(collectionId) {
      const container = document.getElementById("listaRegistrosContainer");
      const collectionName = registroCollections.find(c => c.id === collectionId)?.nombre || collectionId;
      container.innerHTML = `<div>Cargando registros de ${collectionName}...</div>`;
      
      try {
        const snapshot = await db.collection(collectionId).orderBy("nombre").get();
        const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
        // agrupar por nombre
        const mapa = {};
        docs.forEach(r => {
          const key = r.nombre.trim();
          const total = (parseFloat(r.unidadPrecio) || 0) * (parseFloat(r.unidades) || 0);
          if (!mapa[key]) mapa[key] = { nombre: key, unidades: 0, total: 0 };
          mapa[key].unidades += (parseInt(r.unidades) || 0);
          mapa[key].total += total;
        });

        const items = Object.values(mapa);
        // armar tabla HTML
        if (items.length === 0) {
          container.innerHTML = `<div>No hay registros en ${collectionName} aún.</div>`;
          document.getElementById("totalRegistros").textContent = "Total General: $0";
          return;
        }

        let html = '<table class="registrosTable"><thead><tr><th>Producto</th><th>Unidades</th><th>Precio (Total)</th></tr></thead><tbody>';
        let totalGeneral = 0;
        items.forEach(it => {
          html += `<tr><td>${escapeHtml(it.nombre)}</td><td>${it.unidades}</td><td>$${formatNumber(it.total)}</td></tr>`;
          totalGeneral += it.total;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
        document.getElementById("totalRegistros").textContent = "Total General: $" + formatNumber(totalGeneral);
      } catch (e) {
        container.innerHTML = `<div>Error al cargar registros de ${collectionName}: ${e.message}</div>`;
      }
    }

    // ============================================================
    // VISUALIZACIÓN DE VENTAS (SOCIOS) - Muestra tabla de la colección 'ventas' (sin cambios)
    async function renderVisualizacionVentas() {
        const container = document.getElementById("ventasContainer");
        const totalDisplay = document.getElementById("totalVentasGeneral");
        container.innerHTML = "<div>Cargando ventas...</div>";
        totalDisplay.textContent = "Total General: $0";

        try {
            const snapshot = await db.collection("ventas").orderBy("fecha", "desc").get();
            const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));

            if (docs.length === 0) {
                container.innerHTML = "<div>No hay ventas registradas aún.</div>";
                return;
            }

            const agrupado = {
                'Promoción ($250)': { cantidad: 0, total: 0, precioUnidad: 250 },
                'Unidad ($150)': { cantidad: 0, total: 0, precioUnidad: 150 }
            };

            let totalVentasGeneral = 0;

            docs.forEach(v => {
                const promociones = parseInt(v.promociones) || 0;
                const unidades = parseInt(v.unidades) || 0;
                const totalVenta = parseFloat(v.total) || 0;
                
                agrupado['Promoción ($250)'].cantidad += promociones;
                agrupado['Promoción ($250)'].total += (promociones * agrupado['Promoción ($250)'].precioUnidad);
                
                agrupado['Unidad ($150)'].cantidad += unidades;
                agrupado['Unidad ($150)'].total += (unidades * agrupado['Unidad ($150)'].precioUnidad);
                
                totalVentasGeneral += totalVenta;
            });
            
            let htmlAgrupado = '<table class="ventasVisualTable"><thead><tr><th>Promoción o Unidad</th><th>Cantidad Total</th><th>Total Compra Estimado</th></tr></thead><tbody>';

            if (agrupado['Promoción ($250)'].cantidad > 0) {
                htmlAgrupado += `<tr><td>${escapeHtml('Promoción ($250)')}</td><td>${agrupado['Promoción ($250)'].cantidad}</td><td>$${formatNumber(agrupado['Promoción ($250)'].total)}</td></tr>`;
            }
            if (agrupado['Unidad ($150)'].cantidad > 0) {
                 htmlAgrupado += `<tr><td>${escapeHtml('Unidad ($150)')}</td><td>${agrupado['Unidad ($150)'].cantidad}</td><td>$${formatNumber(agrupado['Unidad ($150)'].total)}</td></tr>`;
            }
            htmlAgrupado += '</tbody></table>';
            
            container.innerHTML = htmlAgrupado;
            totalDisplay.textContent = "Total General (Registrado): $" + formatNumber(totalVentasGeneral);
            
        } catch (e) {
            container.innerHTML = "<div>Error al cargar las ventas: " + e.message + "</div>";
            totalDisplay.textContent = "Total General: $0";
        }
    }


    // ============================================================
    // INVERSION - (ACTUALIZADO para incluir todos los eventos)
    async function renderInversion() {
      const container = document.getElementById("inversionContainer");
      container.innerHTML = "<div>Cargando inversión total de todos los registros (Bar y Eventos)...</div>";
      
      try {
        // 1. Asegurarse de tener la lista completa de colecciones de registro
        await loadEventCollections(); 

        // 2. Inicializar totales por socio
        let aldo = 0, ariel = 0, axel = 0;

        // 3. Iterar sobre CADA colección de registro (Bar Principal + Eventos)
        for (const collection of registroCollections) {
            const collectionId = collection.id;
            
            // Obtener todos los documentos de esa colección
            const snapshot = await db.collection(collectionId).get(); 
            const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));

            // 4. Calcular la inversión por documento y sumarla
            docs.forEach(r => {
                const unidadesR = parseFloat(r.unidades) || 0;
                const precioUnidad = parseFloat(r.unidadPrecio) || 0;
                const total = unidadesR * precioUnidad;
                const split = (r.splitType || 'igual').toString();

                if (split === 'igual') {
                    // Partes iguales (1/3)
                    const part = total / 3;
                    aldo += part; 
                    ariel += part; 
                    axel += part;
                } else {
                    // Porcentaje: 60% Aldo, 20% Ariel, 20% Axel
                    aldo += total * 0.6;
                    ariel += total * 0.2;
                    axel += total * 0.2;
                }
            });
        }


        // 5. armar tabla HTML
        let html = '<table class="inversionTable"><thead><tr><th>Nombre Socio</th><th>Inversión Acumulada</th></tr></thead><tbody>';
        html += `<tr><td>Aldo</td><td>$${formatNumber(aldo)}</td></tr>`;
        html += `<tr><td>Ariel</td><td>$${formatNumber(ariel)}</td></tr>`;
        html += `<tr><td>Axel</td><td>$${formatNumber(axel)}</td></tr>`;
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = "<div>❌ Error al calcular inversiones de todos los eventos: " + e.message + "</div>";
      }
    }

    // ============================================================
    // UTILIDADES (sin cambios)
    function formatNumber(n) {
      const rounded = Math.round((n + Number.EPSILON) * 100) / 100;
      if (Number.isInteger(rounded)) return rounded.toString();
      return rounded.toFixed(2);
    }

    function escapeHtml(text) {
      if (!text) return "";
      return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
               .replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    // fin script
  </script>
</body>
</html>
